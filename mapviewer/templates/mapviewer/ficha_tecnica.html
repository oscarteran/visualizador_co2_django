{% extends 'mapviewer/base.html' %}
{% load static %}

{% block title %}Ficha Técnica de Zonas{% endblock %}

{% block content %}
<div class="map-view-container">

    <!-- 1. BARRA DE CONTROLES (Tarjeta Flotante) -->
    <div class="map-control-bar">
        
        <div class="map-header-text mb-3">
            <h2 class="map-title">Información de zona:</h2>
            <p class="map-subtitle">Este mapa despliega la localización de las muestras tomadas, así como el valor medido.</p>
        </div>

        <!-- FILTROS: Envuelta en un formulario para envío de parámetros GET -->
        <!-- La acción se maneja mediante JavaScript en este caso, al tener dos filtros -->
        <form id="map-filter-form-ficha" method="GET" class="filter-toolbelt">
            
            <!-- Filtro 1: Localizaciones/Tipo de Mapa -->
            <div class="map-filter-group me-4">
                <label for="tipo_mapa" class="form-label small-label">Localizaciones</label>
                <select name="tipo_mapa" id="tipo_mapa_ficha" class="form-select custom-select">
                    {% for opcion in opciones_mapa %}
                        <option value="{{ opcion }}" {% if opcion == tipo_mapa_seleccionado %}selected{% endif %}>{{ opcion }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Filtro 2: Ubicación Específica -->
            <div class="map-filter-group">
                <label for="ubicacion" class="form-label small-label">Ubicación</label>
                <select name="ubicacion" id="ubicacion_ficha" class="form-select custom-select">
                    {% for sitio in opciones_ubicacion %}
                        <option value="{{ sitio }}" {% if sitio == ubicacion_seleccionada %}selected{% endif %}>{{ sitio }}</option>
                    {% endfor %}
                </select>
            </div>
            
        </form>
    </div>
    
    <!-- 2. CONTENEDOR DEL MAPA (Tarjeta Flotante Grande) -->
    <div class="map-container-wrapper">
        <!-- El mapa se renderiza aquí -->
        <div class="map-content-area">
            {{ mapa|safe }}
        </div>
        
        <!-- Aquí iría una Leyenda o Tarjeta de Detalle si es necesario -->
        
    </div>

</div>
{% endblock %}

{% block extra_js %}
<!-- Importamos el JS específico para esta vista -->
<script src="{% static 'mapviewer/js/ficha_tecnica_controls.js' %}"></script>
{% endblock %}
